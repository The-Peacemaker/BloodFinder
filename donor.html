<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donor Portal - BloodFinder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">

    <!-- Navbar -->
    <nav class="bg-white/80 backdrop-blur-md shadow-md fixed w-full z-20 top-0">
        <div class="container mx-auto flex justify-between items-center p-4">
            <a href="index.html" class="text-red-500 font-bold text-2xl">ðŸ©¸ BloodFinder</a>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html" class="text-gray-700 hover:text-red-500">HOME</a>
                <a href="donor.html" class="text-red-500 font-semibold">DONORS</a>
                <a href="search.html" class="text-gray-700 hover:text-red-500">SEARCH</a>
                <a href="admin.html" class="text-gray-700 hover:text-red-500">ADMIN</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white p-4">
            <a href="index.html" class="block text-gray-700 hover:text-red-500 py-2">HOME</a>
            <a href="donor.html" class="block text-red-500 font-semibold py-2">DONORS</a>
            <a href="search.html" class="block text-gray-700 hover:text-red-500 py-2">SEARCH</a>
            <a href="admin.html" class="block text-gray-700 hover:text-red-500 py-2">ADMIN</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 min-h-screen">
        <div class="container mx-auto px-4 py-8">

            <!-- Login Form -->
            <div id="loginSection" class="max-w-lg mx-auto">
                <div class="bg-white rounded-xl shadow-xl p-8">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-900">Donor Portal</h2>
                        <p class="text-gray-600 mt-2">Login to your account or register as a new donor</p>
                    </div>

                    <!-- Login Form -->
                    <div id="loginForm">
                        <h3 class="text-xl font-semibold mb-6 text-center text-gray-800">Login</h3>
                        <form id="donorLoginForm" onsubmit="handleDonorLogin(event)">
                            <div class="mb-4">
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="email" name="email" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                            </div>
                            <div class="mb-6">
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" id="password" name="password" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                            </div>
                            <button type="submit"
                                class="w-full bg-red-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-red-600 transition duration-200 transform hover:scale-105">
                                Login
                            </button>
                        </form>
                        <div class="text-center mt-6">
                            <p class="text-gray-600">Don't have an account? 
                                <button onclick="showRegisterForm()" class="text-red-500 hover:text-red-600 font-semibold">Register here</button>
                            </p>
                        </div>
                    </div>

                    <!-- Register Form -->
                    <div id="registerForm" class="hidden">
                        <h3 class="text-xl font-semibold mb-6 text-center text-gray-800">Register as Donor</h3>
                        <form id="donorRegisterForm" onsubmit="handleDonorRegister(event)">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                    <input type="text" id="firstName" name="firstName" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                                </div>
                                <div>
                                    <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                    <input type="text" id="lastName" name="lastName" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="regEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="regEmail" name="email" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                            </div>
                            <div class="mb-4">
                                <label for="regPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" id="regPassword" name="password" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" id="phone" name="phone" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                                </div>
                                <div>
                                    <label for="age" class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                                    <input type="number" id="age" name="age" min="18" max="65" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="bloodGroup" class="block text-sm font-medium text-gray-700 mb-2">Blood Group</label>
                                    <select id="bloodGroup" name="bloodGroup" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                                        <option value="">Select Blood Group</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="city" class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                    <select id="city" name="city" required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200">
                                        <option value="">Select City</option>
                                        
                                        <!-- Kerala Cities (Priority) -->
                                        <optgroup label="ðŸŒ´ Kerala Cities">
                                            <option value="Thiruvananthapuram">Thiruvananthapuram</option>
                                            <option value="Kochi">Kochi (Ernakulam)</option>
                                            <option value="Kozhikode">Kozhikode (Calicut)</option>
                                            <option value="Kottayam">Kottayam</option>
                                            <option value="Thrissur">Thrissur</option>
                                            <option value="Alappuzha">Alappuzha (Alleppey)</option>
                                            <option value="Kollam">Kollam (Quilon)</option>
                                            <option value="Palakkad">Palakkad (Palghat)</option>
                                            <option value="Kannur">Kannur</option>
                                            <option value="Kasaragod">Kasaragod</option>
                                            <option value="Wayanad">Wayanad</option>
                                            <option value="Idukki">Idukki</option>
                                            <option value="Pathanamthitta">Pathanamthitta</option>
                                            <option value="Malappuram">Malappuram</option>
                                            <option value="Aluva">Aluva</option>
                                            <option value="Thodupuzha">Thodupuzha</option>
                                            <option value="Perinthalmanna">Perinthalmanna</option>
                                            <option value="Chalakudy">Chalakudy</option>
                                            <option value="Changanassery">Changanassery</option>
                                            <option value="Kayamkulam">Kayamkulam</option>
                                            <option value="Nedumangad">Nedumangad</option>
                                            <option value="Attingal">Attingal</option>
                                            <option value="Munnar">Munnar</option>
                                            <option value="Varkala">Varkala</option>
                                            <option value="Cherthala">Cherthala</option>
                                            <option value="Muvattupuzha">Muvattupuzha</option>
                                            <option value="Vadakara">Vadakara</option>
                                            <option value="Kanhangad">Kanhangad</option>
                                            <option value="Taliparamba">Taliparamba</option>
                                            <option value="Kondotty">Kondotty</option>
                                        </optgroup>
                                        
                                        <!-- Major Indian Metro Cities -->
                                        <optgroup label="ðŸ™ï¸ Major Metro Cities">
                                            <option value="Mumbai">Mumbai</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Bangalore">Bangalore</option>
                                            <option value="Hyderabad">Hyderabad</option>
                                            <option value="Chennai">Chennai</option>
                                            <option value="Kolkata">Kolkata</option>
                                            <option value="Pune">Pune</option>
                                            <option value="Ahmedabad">Ahmedabad</option>
                                            <option value="Surat">Surat</option>
                                            <option value="Jaipur">Jaipur</option>
                                        </optgroup>
                                        
                                        <!-- North India -->
                                        <optgroup label="ðŸ”ï¸ North India">
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Lucknow">Lucknow</option>
                                            <option value="Kanpur">Kanpur</option>
                                            <option value="Nagpur">Nagpur</option>
                                            <option value="Indore">Indore</option>
                                            <option value="Bhopal">Bhopal</option>
                                            <option value="Gurgaon">Gurgaon</option>
                                            <option value="Noida">Noida</option>
                                            <option value="Faridabad">Faridabad</option>
                                            <option value="Ghaziabad">Ghaziabad</option>
                                            <option value="Agra">Agra</option>
                                            <option value="Meerut">Meerut</option>
                                            <option value="Varanasi">Varanasi</option>
                                            <option value="Allahabad">Allahabad</option>
                                            <option value="Amritsar">Amritsar</option>
                                            <option value="Jalandhar">Jalandhar</option>
                                            <option value="Ludhiana">Ludhiana</option>
                                            <option value="Dehradun">Dehradun</option>
                                            <option value="Haridwar">Haridwar</option>
                                            <option value="Shimla">Shimla</option>
                                            <option value="Jammu">Jammu</option>
                                            <option value="Srinagar">Srinagar</option>
                                        </optgroup>
                                        
                                        <!-- West India -->
                                        <optgroup label="ðŸŒ… West India">
                                            <option value="Nashik">Nashik</option>
                                            <option value="Aurangabad">Aurangabad</option>
                                            <option value="Kolhapur">Kolhapur</option>
                                            <option value="Sangli">Sangli</option>
                                            <option value="Solapur">Solapur</option>
                                            <option value="Vadodara">Vadodara</option>
                                            <option value="Rajkot">Rajkot</option>
                                            <option value="Bhavnagar">Bhavnagar</option>
                                            <option value="Jamnagar">Jamnagar</option>
                                            <option value="Gandhinagar">Gandhinagar</option>
                                            <option value="Anand">Anand</option>
                                            <option value="Udaipur">Udaipur</option>
                                            <option value="Jodhpur">Jodhpur</option>
                                            <option value="Kota">Kota</option>
                                            <option value="Ajmer">Ajmer</option>
                                            <option value="Bikaner">Bikaner</option>
                                            <option value="Goa">Goa</option>
                                        </optgroup>
                                        
                                        <!-- South India -->
                                        <optgroup label="ðŸŒº South India">
                                            <option value="Mysore">Mysore</option>
                                            <option value="Mangalore">Mangalore</option>
                                            <option value="Hubli">Hubli</option>
                                            <option value="Belgaum">Belgaum</option>
                                            <option value="Coimbatore">Coimbatore</option>
                                            <option value="Madurai">Madurai</option>
                                            <option value="Salem">Salem</option>
                                            <option value="Tiruchirappalli">Tiruchirappalli</option>
                                            <option value="Tirunelveli">Tirunelveli</option>
                                            <option value="Vellore">Vellore</option>
                                            <option value="Pondicherry">Pondicherry</option>
                                            <option value="Visakhapatnam">Visakhapatnam</option>
                                            <option value="Vijayawada">Vijayawada</option>
                                            <option value="Guntur">Guntur</option>
                                            <option value="Nellore">Nellore</option>
                                            <option value="Tirupati">Tirupati</option>
                                            <option value="Warangal">Warangal</option>
                                            <option value="Karimnagar">Karimnagar</option>
                                            <option value="Nizamabad">Nizamabad</option>
                                        </optgroup>
                                        
                                        <!-- East India -->
                                        <optgroup label="ðŸŒ… East India">
                                            <option value="Bhubaneswar">Bhubaneswar</option>
                                            <option value="Cuttack">Cuttack</option>
                                            <option value="Rourkela">Rourkela</option>
                                            <option value="Guwahati">Guwahati</option>
                                            <option value="Silchar">Silchar</option>
                                            <option value="Dibrugarh">Dibrugarh</option>
                                            <option value="Shillong">Shillong</option>
                                            <option value="Imphal">Imphal</option>
                                            <option value="Aizawl">Aizawl</option>
                                            <option value="Agartala">Agartala</option>
                                            <option value="Kohima">Kohima</option>
                                            <option value="Itanagar">Itanagar</option>
                                            <option value="Gangtok">Gangtok</option>
                                            <option value="Siliguri">Siliguri</option>
                                            <option value="Durgapur">Durgapur</option>
                                            <option value="Asansol">Asansol</option>
                                            <option value="Ranchi">Ranchi</option>
                                            <option value="Jamshedpur">Jamshedpur</option>
                                            <option value="Dhanbad">Dhanbad</option>
                                            <option value="Patna">Patna</option>
                                            <option value="Gaya">Gaya</option>
                                            <option value="Muzaffarpur">Muzaffarpur</option>
                                            <option value="Purnia">Purnia</option>
                                        </optgroup>
                                        
                                        <!-- Central India -->
                                        <optgroup label="ðŸžï¸ Central India">
                                            <option value="Raipur">Raipur</option>
                                            <option value="Bilaspur">Bilaspur</option>
                                            <option value="Jabalpur">Jabalpur</option>
                                            <option value="Gwalior">Gwalior</option>
                                            <option value="Ujjain">Ujjain</option>
                                            <option value="Dewas">Dewas</option>
                                            <option value="Sagar">Sagar</option>
                                            <option value="Ratlam">Ratlam</option>
                                            <option value="Satna">Satna</option>
                                            <option value="Murwara">Murwara</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-6">
                                <label for="address" class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                <textarea id="address" name="address" rows="3" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-200"></textarea>
                            </div>
                            <button type="submit"
                                class="w-full bg-red-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-red-600 transition duration-200 transform hover:scale-105">
                                Register as Donor
                            </button>
                        </form>
                        <div class="text-center mt-6">
                            <p class="text-gray-600">Already have an account? 
                                <button onclick="showLoginForm()" class="text-red-500 hover:text-red-600 font-semibold">Login here</button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboardSection" class="hidden">
                <div class="max-w-6xl mx-auto">
                    <div class="bg-white rounded-xl shadow-xl p-8 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900">Welcome, <span id="donorName">Donor</span>!</h2>
                                <p class="text-gray-600">Manage your donor profile and availability</p>
                            </div>
                            <button onclick="logout()" 
                                class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                                Logout
                            </button>
                        </div>

                        <!-- Availability Toggle -->
                        <div class="bg-gray-50 rounded-lg p-6 mb-8">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Availability Status</h3>
                                    <p class="text-gray-600">Toggle your availability for blood donation</p>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <span id="availabilityStatus" class="text-lg font-semibold text-gray-800">Available</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="availabilityToggle" class="sr-only peer" onchange="toggleAvailability()">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Profile Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <div class="bg-red-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-red-800 mb-2">Blood Group</h4>
                                <p id="donorBloodGroup" class="text-2xl font-bold text-red-600">-</p>
                            </div>
                            <div class="bg-blue-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-blue-800 mb-2">Total Donations</h4>
                                <p id="totalDonations" class="text-2xl font-bold text-blue-600">0</p>
                            </div>
                            <div class="bg-green-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-green-800 mb-2">Lives Saved</h4>
                                <p id="livesSaved" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                        </div>

                        <!-- Emergency Requests -->
                        <div class="bg-yellow-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-yellow-800 mb-4">Emergency Blood Requests</h3>
                            <div id="emergencyRequests">
                                <p class="text-yellow-700">No emergency requests at the moment.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <span id="toastMessage"></span>
    </div>

    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Form switching functions
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `fixed top-20 right-4 px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white`;
            
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // Handle donor login
        async function handleDonorLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password, role: 'donor' }),
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    sessionStorage.setItem('token', data.token);
                    sessionStorage.setItem('user', JSON.stringify(data.user));
                    showDashboard(data.user);
                    showToast('Login successful!');
                } else {
                    showToast(data.message || 'Login failed', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please try again.', 'error');
            }
        }

        // Handle donor registration
        async function handleDonorRegister(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const userData = Object.fromEntries(formData);
            userData.role = 'donor';
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData),
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    sessionStorage.setItem('token', data.token);
                    sessionStorage.setItem('user', JSON.stringify(data.user));
                    showDashboard(data.user);
                    showToast('Registration successful!');
                } else {
                    showToast(data.message || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showToast('Registration failed. Please try again.', 'error');
            }
        }

        // Show dashboard
        function showDashboard(user) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            document.getElementById('donorName').textContent = user.firstName + ' ' + user.lastName;
            document.getElementById('donorBloodGroup').textContent = user.bloodGroup;
            document.getElementById('availabilityToggle').checked = user.isAvailable || false;
            updateAvailabilityStatus(user.isAvailable || false);
            
            loadEmergencyRequests();
        }

        // Toggle availability
        async function toggleAvailability() {
            const isAvailable = document.getElementById('availabilityToggle').checked;
            
            try {
                const response = await fetch('/api/donor/availability', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + sessionStorage.getItem('token'),
                    },
                    body: JSON.stringify({ isAvailable }),
                });
                
                if (response.ok) {
                    updateAvailabilityStatus(isAvailable);
                    showToast(`Availability ${isAvailable ? 'enabled' : 'disabled'}`);
                } else {
                    document.getElementById('availabilityToggle').checked = !isAvailable;
                    showToast('Failed to update availability', 'error');
                }
            } catch (error) {
                console.error('Availability update error:', error);
                document.getElementById('availabilityToggle').checked = !isAvailable;
                showToast('Failed to update availability', 'error');
            }
        }

        // Update availability status text
        function updateAvailabilityStatus(isAvailable) {
            const statusElement = document.getElementById('availabilityStatus');
            statusElement.textContent = isAvailable ? 'Available' : 'Not Available';
            statusElement.className = `text-lg font-semibold ${isAvailable ? 'text-green-600' : 'text-red-600'}`;
        }

        // Load emergency requests
        async function loadEmergencyRequests() {
            try {
                const response = await fetch('/api/emergency/requests', {
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('token'),
                    },
                });
                
                if (response.ok) {
                    const requests = await response.json();
                    displayEmergencyRequests(requests);
                }
            } catch (error) {
                console.error('Error loading emergency requests:', error);
            }
        }

        // Display emergency requests
        function displayEmergencyRequests(requests) {
            const container = document.getElementById('emergencyRequests');
            
            if (requests.length === 0) {
                container.innerHTML = '<p class="text-yellow-700">No emergency requests at the moment.</p>';
                return;
            }
            
            container.innerHTML = requests.map(request => `
                <div class="bg-white p-4 rounded-lg shadow mb-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-semibold text-gray-800">${request.patientName}</h4>
                            <p class="text-gray-600">Blood Group: <span class="font-semibold text-red-600">${request.bloodGroup}</span></p>
                            <p class="text-gray-600">Hospital: ${request.hospital}</p>
                            <p class="text-gray-600">Contact: ${request.contactNumber}</p>
                            <span class="inline-block px-2 py-1 rounded text-xs font-semibold ${
                                request.urgencyLevel === 'critical' ? 'bg-red-100 text-red-800' :
                                request.urgencyLevel === 'high' ? 'bg-orange-100 text-orange-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">
                                ${request.urgencyLevel.toUpperCase()} PRIORITY
                            </span>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-500">${new Date(request.createdAt).toLocaleDateString()}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Logout function
        function logout() {
            sessionStorage.removeItem('token');
            sessionStorage.removeItem('user');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
            showToast('Logged out successfully');
        }

        // Check if user is already logged in
        window.addEventListener('load', function() {
            const token = sessionStorage.getItem('token');
            const user = sessionStorage.getItem('user');
            
            if (token && user) {
                const userData = JSON.parse(user);
                if (userData.role === 'donor') {
                    showDashboard(userData);
                }
            }
        });
    </script>

</body>
</html>